## Image Processing 기초

### 09.16
#### Otsu's Algorithm 직접 구현
이미지는 많은 정보를 함축한다. 몇몇 정보는 아무 작업을 거치지 않고, 눈으로만 보아도 알아낼 수 있지만, 전처리를 해야만 보이는 정보들도 있다. Image Processing의 기본 스킬 중 하나는 이미지 이진화이다. 쉽게 말하면 컬러사진을 흑백사진으로 바꾸는 과정이다. 
이미지를 행렬로 본다면, 칼라 이미지는 빨강, 초록, 파랑을 가진 3 채널의 행렬로 생각할 수 있다. 이 3채널을 특정한 규칙에 따라 0(흰색)에서 255(검은색)의 범위 내의 값을 갖는 1차원 행렬로 바꾸는 것이다. opencv 모듈에서는 cv2.threshold, cv2.adaptiveThreshold가 이 기능을 수행한다.
예를 들어, cv2.threshold(img,threshold, v, cv2.THRESH_BINARY)는 각각의 채널의 행렬에 대해 threshold를 넘은 값들에 대해서는 v의 값들로 치환하고 채널의 평균을 내서 1차원의 행렬을 리턴한다.
이진화에 대한 컨셉은 대충 알겠고, 적절한 threshold를 정하는 것이 관건이다. 이 threshold를 정해주는 알고리즘 중 하나가 Otsu's Algorithm이다. cv2.THRESH_OTSU로 편리하게 구현할 수 있지만, 어떠한 원리로 이런 값이 찾아지는지 모른다면, 활용 또한 쉽지 않을 것이다. 직접 구현해보자

기본 컨셉은 이렇다. 이미지의 픽셀값들을 히스토그램으로 나열할 때, threshold를 기준으로 두 개의 분포도가 나올 것이다. threshold 값이 적당하다면, 이 두 분포의 분산은 최소값을 가질 것이라는 게 아이디어다. 코드는 np.hsplit을 사용해, 행렬의 길이를 1부터 255까지로 나누고, 비용함수를 weight1*s1^2+weight2*s2^2로 설정해서, 최소값을 갱신해나간다.

### 09.17
#### 이미지 파일 종류
오늘 아침 출근하는 길에 NLP데이터 전처리에 관한 기사를 보았다. 데이터 분석에 있어서 전처리는 실질적인 분석을 위해 꼭 필요한 과정이다. 전처리를 잘 하기 위해서는 다루고 있는 데이터에 대한 올바른 이해가 필요한데, 이미지 데이터를 공부하기로 마음먹은 나는 이런 생각이 들었다. 내가 과연 다루고 있는 이미지들에 대해서 얼마나 잘 아는가.
우리가 생각하는 이미지 파일 형식은 크게 jpeg, png, gif, pdf, bmp가 있다. (이미지의 한 픽셀당 보통 3바이트 정도의 용량을 차지한다. RGB 기준 한 채널당 1바이트. 0부터 255까지의 값이므로 8비트=1바이트가 필요할 것이고, 채널이 3개가 있으니 3바이트) 
JPEG는 이 형식을 개발한 Joint Photographic Experts Group의 약어다. JPEG는 압축 형식으로 디테일을 일부 희생시켜 파일 크기를 줄인다. 압축률은 평균 25:1 정도 되고, 인간의 눈이 색상보다는 밝기에 덜 민감하다는 점에 착안해서 RGB를 YUV(Y가 밝기) 포맷으로 바꾸는 등 여러가지의 압축 방법을 사용해서 줄인다는데 디테일까지는 나중에 한 번 다시 봐야겠다. 오늘 엄청난 성과는 JPEG=JPG라는 것이다. 예전에 컴퓨터가 확장자명을 세글자밖에 허용하지 않던 시절에 JPEG를 줄여서 JPG라고 표기했다고한다. 이걸 몰랐다니...
TIFF는 Tagged Image File Format의 약어이며 고품질 이미지 인쇄 분야에서 오래 전부터 표준으로 사용되는 형식이다. TIFF는 거의 모든 앱에서 지원되며 포토샵에서 생성한 레이어를 지원할 수 있다. TIFF의 품질은 항상 원본과 동일하게 유지되지만 그 대가로 파일 크기가 상당히 커질 수 있다. 한때 디자이너들은 거의 TIFF만 사용했지만 요즘 전문가급 페이지 레이아웃 앱은 TIFF와 동일한 화질을 더 작은 파일 크기로 제공하는 네이티브 포토샵 파일을 다룰 수 있다. 종이책이나 브로셔, 잡지에 포함할 이미지를 전송하는 경우 고품질 JPEG로 보낼 수도 있지만 가장 안전한 방법을 원한다면 비압축 TIFF로 전송하는 것이 좋다. 이 부분은 솔직히 itworld 기사에서 복붙해왔다. TIFF 파일은 접할 일이 거의 없을 것 같다.
PNG는 Portable Network Graphics의 약어로, 보통 이미지가 3차원인데 (R,G,B) 반해 PNG는 4차원의 정보 (R,G,B,A) 를 갖는다. 4번째 채널은 알파 채널로, 투명한 값들에 대한 정보이다. 주로 0이나 255 값을 갖는다고 한다. 다양한 색과 투명 백그라운드를 지원하는 특성 덕분에 다른 백그라운드 위에 그래픽을 얹는 경우 유용하다. 이 형식은 무손실 압축을 사용하므로 이미지 디테일 손실이 전혀 없다. 그리고 차원이 하나가 더 많으니 더 고품질 이미지를 생성하지만 파일 크기는 JPEG에 비해 더 커진다.

PNG에는 PNG-8과 PNG-24, 두 가지 형태가 있다. PNG-24는 더 많은 색을 지원하며 부분적 투명 픽셀도 지원한다. 이는 투명 배경이 있는 이미지에 그림자 효과를 추가하는 경우, 또는 온라인에 게시하고자 하는 이미지에 그래디언트(넓은 하늘과 같이 색이 부드럽게 전환되는 부분)가 풍부한 경우 유리하다. PNG 형식은 JPEG와 달리 온라인에 게시할 때도 텍스트와 로고를 선명하게 유지하므로 소셜 미디어 표지 이미지에 적합하다. 그 외에 슬라이드 데크(키노트 또는 파워포인트용)를 위한 고화질 그래픽, 온라인 사진 포트폴리오에 게시할 고품질 이미지 등에도 유용하다. 또한 페이스북의 압축 알고리즘의 화질 손실도 JPEG에 비해 PNG가 낮은 것으로 알려져 있다.

GIF는 Graphics Interchange Format의 약어다. 색 수가 제한된 웹 그래픽(예: 웹툰 그림), 투명 배경 또는 애니메이션을 위한 작은 용량의 파일을 생성한다. 요즘은 고속 인터넷 덕분에 정적 그래픽에서 GIF의 인기는 예전만 못하지만(PNG 품질이 더 높음) 웹 또는 슬라이드 데크의 애니메이션 그래픽용으로는 여전히 널리 사용된다.

PDF는 Portable Document Format의 약어이며 단일/다중 페이지 문서를 보거나 인쇄하는 용도로 광범위하게 사용되는 형식이다. PDF 형식으로 파일을 저장하는 것은 파일을 사진으로 찍는 것과 같다. 파일에 있는 모든 글꼴, 이미지, 비디오가 포함되므로 원본 파일을 생성한 소프트웨어가 없어도 원본과 똑같이 볼 수 있다. 현재 지구상에 사용되는 거의 대부분의 컴퓨터는 PDF 파일 형식을 열고 인쇄할 수 있다.

PDF 파일은 압축이 가능하지만 압축을 할 필요는 없다. 파일을 저장할 때 옵션만 선택하면 된다. 이러한 이유로 기업에서 초대장, 명함, 엽서, 브로셔 등의 인쇄 용도로 PDF 형식을 선호하는 경우가 많다. 맥에서 인쇄 가능한 모든 파일에서 고품질 PDF를 생성할 수 있다. 파일(File) > 인쇄(Print)를 선택하고 대화 상자에서 왼쪽 하단의 PDF를 클릭하고 PDF로 저장(Save as PDF)을 선택한다. 애플 포토에서도 책, 달력, 카드 프로젝트를 PDF 형식으로 저장해 손쉽게 공유할 수 있다.

BMP는 윈도우 기반 PC에 널리 사용되는 그래픽 파일 형식이다. 회사에서 PC를 사용하거나 그런 친구를 뒀다면 BMP 파일 형식을 본 적이 있을 것이다. 그 외에도 많은 형식이 있지만 이 정도가 가장 흔히 사용된다.


